#
#  Makefile for generated Cpp client:  Make sure you set JDKDIR and 
#  CLASSPATH for your environment; also set INCLUDES and LIBDIR to 
#  match the location of the required headers and libraries.
#

%ifvar platform equals(win)%
JDKDIR = C:\Progra~1\Java\jdk1.5.0_12
WMDIR = D:\webMethods712
LIBDIR = $(WMDIR)\IntegrationServer\sdk\cpp\lib
CPPINC = $(WMDIR)\IntegrationServer\sdk\cpp\include
INCLUDES = -I$(LIBDIR) -I$(CPPINC) -I$(JDKDIR)\include -I$(JDKDIR)\include\win32
CLASSES = .;$(JDKDIR)/jre/lib/rt.jar;$(JDKDIR)/lib/tools.jar;$(WMDIR)/common/lib/wm-isclient.jar;$(WMDIR)/common/lib/glassfish/gf.javax.mail.jar;$(WMDIR)/IntegrationServer/lib/wm-isserver.jar;
LIBS = .;$(LIBDIR);$(JDKDIR)\bin;$(PATH)
CPPFLAGS = /nologo /ML /W2 /GX /O2 /Zi -c


all: %value svcName%.exe

%value svcName%.obj: %value svcName%.cpp
	cl -DWIN32 $(INCLUDES) $(CPPFLAGS) %value svcName%.cpp 

%value svcName%.exe: %value svcName%.obj
	link.exe /nologo /out:"%value svcName%.exe" %value svcName%.obj \
	$(LIBDIR)\WinWMJni.lib $(JDKDIR)\lib\jvm.lib

runtest: %value svcName%.exe
	set PATH=$(LIBS)
	set CLASSPATH=$(CLASSES)
	.\%value svcName%.exe

clean:
	del %value svcName%.obj
	del %value svcName%.exe

%else%
JDKDIR = /usr/java
WMDIR = /opt/webmethods
LIBDIR = $(WMDIR)/IntegrationServer/sdk/cpp/lib
INCLUDES = $(WMDIR)/IntegrationServer/sdk/cpp/include
CLASSES = .:$(JDKDIR)/jre/lib/rt.jar:$(JDKDIR)/lib/tools.jar:$(WMDIR)/common/lib/wm-isclient.jar:$(WMDIR)/common/lib/glassfish/gf.javax.mail.jar:$(WMDIR)/IntegrationServer/lib/wm-isserver.jar

%switch platform%
%case lnx%
# Set ARCH to the value returned by `arch`
COPT = -g -fPIC
ARCH = i386
THRDIR = $(JDKDIR)/jre/lib/$(ARCH)
LIBS = .:$(THRDIR):$(THRDIR)/native_threads:$(THRDIR)/client:$(LD_LIBRARY_PATH)

all: %value svcName%%nl%

%value svcName%: %value svcName%.c
	g++ $(COPT) -I$(JDKDIR)/include -I$(JDKDIR)/include/linux \
		-I$(INCLUDES) %value svcName%.cpp \
		-L$(LIBDIR) -lwmjni -L$(THRDIR)/native_threads -lhpi -L$(THRDIR)/client -ljvm \
		-o %value svcName%%nl%

runtest: %value svcName%%nl%
	LD_LIBRARY_PATH=$(LIBS); CLASSPATH=$(CLASSES); ./%value svcName%

%case sol%
COPT = -g -fpic
THRDIR = $(JDKDIR)/jre/lib/sparc
LIBS = .:$(THRDIR):$(LD_LIBRARY_PATH)

all: %value svcName%%nl%

%value svcName%: %value svcName%.cpp
	g++ $(COPT) -I$(JDKDIR)/include -I$(JDKDIR)/include/solaris \
		-I$(INCLUDES) %value svcName%.cpp \
		$(LIBDIR)/libwmjni.a -L$(THRDIR) -ljvm -lpthread \
		-o %value svcName%%nl%
		
runtest: %value svcName%%nl%
	LD_LIBRARY_PATH=$(LD_LIBRARY_PATH):$(THRDIR):$(LIBDIR):/usr/local/lib \
	CLASSPATH=$(CLASSPATH).:$(JDKDIR)/jre/lib/rt.jar:$(JDKDIR)/lib/tools.jar:$(WMDIR)/common/lib/wm-isclient.jar:$(WMDIR)/common/lib/glassfish/gf.javax.mail.jar:$(WMDIR)/IntegrationServer/lib/wm-isserver.jar \
	./%value svcName%

%case hpx%
COPT = -g -D_HPUX  -Dunix -Dhpux -AA -ext -mt -DNATIVE -D_POSIX_C_SOURCE=199506L
THRDIR = $(JDKDIR)/jre/lib/PA_RISC2.0

all: %value svcName%%nl%

%value svcName%: %value svcName%.cpp
	aCC $(COPT) -o %value svcName% -I$(JDKDIR)/include -I$(JDKDIR)/include/hp-ux \
		-I$(INCLUDES) %value svcName%.cpp \
		-L$(THRDIR)/server -ljvm -lrt -lpthread -llwp \
		-L$(LIBDIR) -L$(THRDIR)/native_threads -lhpi $(LIBDIR)/libwmjni.a

runtest: %value svcName%%nl%
	SHLIB_PATH=.:$(THRDIR):$(THRDIR)/classic:$(LIBDIR):$(SHLIB_PATH) \
	CLASSPATH=$(CLASSPATH).:$(JDKDIR)/jre/lib/rt.jar:$(JDKDIR)/lib/tools.jar:$(WMDIR)/common/lib/wm-isclient.jar:$(WMDIR)/common/lib/glassfish/gf.javax.mail.jar:$(WMDIR)/IntegrationServer/lib/wm-isserver.jar ./%value svcName%

%case aix%
COPT = -g
THRDIR = $(JDKDIR)/jre/lib/ppc
LIBS = .:$(THRDIR):$(THRDIR)/classic:$(LIBPATH)

all: %value svcName%%nl%

%value svcName%: %value svcName%.cpp
	xlC_r $(COPT) -I$(JDKDIR)/include -I$(JDKDIR)/include/aix \
		-I$(INCLUDES) %value svcName%.cpp \
		-L$(LIBDIR) -lwmjni \
		-L$(THRDIR)/classic -ljvm -lc \
		-o %value svcName%%nl%
		
runtest: %value svcName%%nl%
	export LIBPATH=$(LIBS); \
	CLASSPATH=.:$(JDKDIR)/jre/lib/rt.jar:$(JDKDIR)/lib/tools.jar:$(WMDIR)/common/lib/wm-isclient.jar:$(WMDIR)/common/lib/glassfish/gf.javax.mail.jar:$(WMDIR)/IntegrationServer/lib/wm-isserver.jar ./%value svcName%

%end%

clean:
	rm -f %value svcName%.o
	rm -f %value svcName%

%endif%

